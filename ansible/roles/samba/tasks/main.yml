# Create User for samba
- name: Create User samba
  user:
    name: "{{ samba_user_name }}"
    comment: User for samba docker
    system: yes
    create_home: "no"
    uid: "{{ samba_user_id }}"
    group: "{{ samba_group_name}}"

# Create config directory
- name: Create samba Directory
  file:
    path: "{{ item }}"
    state: directory
    owner: "{{ samba_user_name }}"
    group: "{{ samba_group_name }}"
    seuser: "{{ se_file_user }}"
    serole: "{{ se_file_role }}"
    setype: "{{ se_file_type }}"
    recurse: "true"
  with_items:
    - "{{ samba_dirs }}"

# Start the samba docker container with prepared config file
- name: Start samba
  docker_container:
    name: samba
    hostname: samba
    image: dperson/samba
    state: started
    restart_policy: unless-stopped
    volumes:
      - "{{ samba_dir_etc }}:/etc:Z"
      - "{{ samba_dir_cache }}:/var/samba/cache:Z"
      - "{{ samba_dir_lib }}:/var/samba/lib:Z"
      - "{{ samba_dir_log }}:/var/samba/log:Z"
      - "{{ samba_dir_run }}:/run/samba:Z"
    ports:
      - 139:139
      - 445:445
    env:
      TZ: "Europe/Berlin"
      USER: "markus;markus;1000;1000"
    command: [
      "/usr/bin/samba.sh",
      "-s \"Downloads;/downloads;yes;no;no;markus;markus\"",
      "-s \"Markus;/markus;yes;no;no;markus;markus\""
    ]
